<!DOCTYPE html>
<html class="theme-next muse use-motion">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>liukelin - elastic 分词插件</title>
<style type="text/css">
/*table.hovertable {
    font-family: verdana,arial,sans-serif;
    font-size:11px;
    color:#333333;
    border-width: 1px;
    border-color: #999999;
    border-collapse: collapse;
}
table.hovertable th {
    background-color:#c3dde0;
    border-width: 1px;
    padding: 8px;
    border-style: solid;
    border-color: #a9c6c9;
}*/
/*table.hovertable tr {
    background-color:#d4e3e5;
}*/

div.analyze_div  {
    margin:5px 5px;
}
div.analyze_div span:hover{
    /*background-color: red ;*/
    border:1px solid red;
}
div.analyze_div span {
    background-color: #4CAF50;
    padding:0 5px;
    margin:0 3px;
}
.bg1{
    font-weight:bold;
    color:#F00;
}
.bg2{
    font-weight:bold;
    color:#F00;
}

.div0{
    padding:5px 0;
    width:100%;
}


.div1{
    margin:5px 5px;
    padding:5px 5px;
    border:1px solid #C0C0C0;
}
.div2{
    margin:5px 5px;
    padding:5px 5px;
    border:1px solid #C0C0C0;
}

.button1{
    padding:5px 5px;
    border:2px solid #77DDFF;
    height:25px;
}

.button2{
    padding:5px 5px;
    border:2px solid #77DDFF;
    height:25px;
    
}

.button3{
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 5px 10px;
    margin:5px 5px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    /*font-size: 16px;*/
}

</style>

<script type="text/javascript" src="./js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="./js/jquery-ui-1.12.1.custom/jquery-ui.js"></script>
<link rel="stylesheet" href="./js/jquery-ui-1.12.1.custom/jquery-ui.css">

</head>

<body style="padding:5px 15px">
<div class="div0">
    词句：
    <input type="text" id="word" style="width:350px;height:25px" value="" >&nbsp;&nbsp;

    插件：
    <select id="plugins" >
      <option value ="ik" title="">ik</option>
    </select>&nbsp;&nbsp;

    模式：
    <select id="ik_type">
      <option value ="ik_max_word" title="ik_max_word：会将文本做最细粒度的拆分；尽可能多的拆分出词语">ik_max_word</option>
      <option value ="ik_smart" title="ik_smart：会做最粗粒度的拆分；已被分出的词语将不会再次被其它词语占有">ik_smart</option>
    </select>&nbsp;&nbsp;

    <input type="button" name="" id="search" value="搜索" class="button1 button3">
    
    &nbsp;&nbsp;
    <input type="button" name="" id="add_content" value="新增测试文章"  class="button2 button3" onClick="show_add_content()">
    <input type="button" name="" id="" value="添加自定义分词"  class="button2 button3" onclick="add_custom_word('hot', '添加自定义分词')">
    <input type="button" name="" id="" value="添加屏蔽分词"  class="button2 button3" onclick="add_custom_word('stop','添加屏蔽分词')">
    <input type="button" name="" id="" value="添加同义词"  class="button2 button3">

</div>


<div class="div1" id="div1" style="display: none">
    ik_max_word:
    <div class="analyze_div" id="analyze_span1"><span>asdas</span><span>asdas</span></div>
    ik_smart:
    <div class="analyze_div" id="analyze_span2"><span>asdas</span><span>asdas</span></div>
</div>
<!-- Table goes in the document BODY -->
<div class="" id="list">
    
</div>

<!-- 添加文章 -->
<div id="add_content_dialog" title="添加测试文章" style="display: none">
   <textarea class="div2" id="text_content" style="width: 95%;height: 90%"></textarea>
</div>

<!-- 自定义分词 -->
<div id="add_custom_word" title="添加自定义分词-" style="display: none">
   词汇：<input type="text" id="custom_word" style="width:350px;height:25px">
   <div class="analyze_div" id="custom_word_div"></div>
</div>

<script type="text/javascript">

    $(function(){
        _search();
        $('#search').click(function(){
            _analyze();
            _search();
        });

        // 输入自动补全
        $("#word").autocomplete({
            source: "/elastic-search-analyzer/controller/api.php?action=suggester" // 实际为 /ajax-actions.php?term=c
        });

    });

    function _search(){
        // search
        $.ajax({
            type: 'POST',
            data:{
                action:'search',
                word:$('#word').val(),
                plugins:$('#plugins').val(),
                ik_type:$('#ik_type').val()
            },
            url: '/elastic-search-analyzer/controller/api.php',
            dataType: 'json',
            success: function(data){
                var html = '';
                if (data) {
                    if (data.list && data.list.length>0) {
                        $.each(data.list, function(key,val){
                            html += '<div class="div2">'+val.content+'</div>';
                        }); 
                    }
                }else{
                    alert('error.');
                }
                if (html=='') {
                    html='<div class="div2">没有记录.</div>';
                }
                $('#list').html(html);
            }
        });
    }

    

    // 分词接口 analyze
    function _analyze(){
        // analyze
        $.ajax({
            type: 'POST',
            data:{
                action:'analyze',
                word:$('#word').val(),
                // ik_type:$('#ik_type').val()
            },
            url: '/elastic-search-analyzer/controller/api.php',
            dataType: 'json',
            success: function(data){
                var html1 = '';
                var html2 = '';
                if (data) {
                    if (data.ik_max_word && data.ik_max_word.tokens && data.ik_max_word.tokens.length>0) {
                        $.each(data.ik_max_word.tokens, function(key,val){
                            html1 += '<span>'+val.token+'</span>';
                        }); 
                    }
                    if (data.ik_smart && data.ik_smart.tokens && data.ik_smart.tokens.length>0) {
                        $.each(data.ik_smart.tokens, function(key,val){
                            html2 += '<span>'+val.token+'</span>';
                        }); 
                    }
                }else{
                    alert('error.');
                }
                if (html1!='' || html2!='') {
                    $('#div1').show();
                }else{
                    $('#div1').hide();
                }
                $('#analyze_span1').html(html1);
                $('#analyze_span2').html(html2);
            }
        });
    }


    // 添加测试文章
    function show_add_content(){
        $( "#add_content_dialog" ).dialog({ 
                width: 800,
                height: 550,
                buttons: { 
                    "取消": function() { 
                        $(this).dialog("close"); 
                        $('#text_content').val('');
                    } ,
                    "添加": function() { 

                        $.ajax({
                                type: 'POST',
                                data:{
                                    action:'add_test_content',
                                    content:$('#text_content').val(),
                                    // way_type:$('#way_type').val()
                                },
                                url: '/elastic-search-analyzer/controller/api.php',
                                dataType: 'json',
                                success: function(data){
                                    alert(data.msg);
                                    $('#text_content').val('');
                                    $( "#add_content_dialog" ).dialog("close");
                                }
                            });

                     } 
                }  
            });
    }

    // 自定义分词
    function get_custom_word(type){
        $.ajax({
            type: 'get',
            url: '/elastic-search-analyzer/controller/api.php?action=custom_word&type='+type,
            dataType: 'json',
            success: function(data){
                var html = '';
                if (data.data  && data.data.length>0) {
                    $.each(data.data, function(key,val){
                        html += '<span>'+val+'</span>';
                    });
                }
                $('#custom_word_div').html(html);
            }
        });
    }
    // 添加自定义分词
    function add_custom_word(type, title=''){
        $('#custom_word_div').attr('title',title);
        get_custom_word(type);
        $( "#add_custom_word" ).dialog({ 
                width: 800,
                height: 550,
                buttons: { 
                    "取消": function() { 
                        $(this).dialog("close"); 
                        $('#custom_word').val('');
                    } ,
                    "添加": function() { 

                        $.ajax({
                                type: 'POST',
                                data:{
                                    action:'custom_word',
                                    work:$('#custom_word').val(),
                                    type:type
                                },
                                url: '/elastic-search-analyzer/controller/api.php',
                                dataType: 'json',
                                success: function(data){
                                    alert(data.msg);
                                    $('#custom_word').val('');
                                    get_custom_word(type);
                                }
                        });
                        
                    } 
                }  
            });
        
    }
 

</script>

</body>
</html>











